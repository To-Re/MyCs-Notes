# 8 IO 库

## 8.1 IO 类

`iostream` 定义了用于读写流的基本数据类型

`fsttream` 定义了读写命名文件的类型

`sstream` 定义了读写内存 `string` 对象的类型



为支持宽字符的语言，标准库定义了一组类型和对象操纵 `wchar_t` 类型。

宽字符版本的类型和函数名以一个 `w` 开始，例如 `wcin`、`wcout`、`wcerr` 对应无 `w` 版本的读写函数。

宽字符版本和普通版本定义在同一个头文件中。



#### IO 类型间的关系

通过『继承』可以忽略不同类型的流之间的差异。



### 8.1.1 IO 对象无拷贝或赋值

不能拷贝或对 IO 对象赋值。

因为不能拷贝所以不能将形参或返回类型设置为流类型，可以传引用但不能 `const`，读写会修改 IO 对象状态。



### 8.1.2 条件状态

IO 类定义了一些函数和标志，用来访问操纵流的『条件状态』

流可以当作条件判断是否处于良好状态，如

```cpp
while(cin >> word) {} // 输入成功流保持有效，为真
```



#### 查询流的状态

`iostate` 类型，提供表达流状态的完整功能。



#### 管理条件状态



### 8.1.3 管理输出缓存

输出流管理一个缓存区，保存程序读写的数据。

导致缓存刷新（数据真正输出到设备或文件）原因有许多：

+ 程序正常结束，作为 `main` 函数的 `return` 操作的一部分，缓冲刷新被执行。
+ 缓冲区满了
+ 操作符如 `endl` 显式的刷新
+ 操作符 `unitbuf` 设置流内部状态，刷新。
+ 没看懂，输出流被关联到另一个流。



#### 刷新输出缓冲区

操作符

`endl`：输出换行并刷新

`flush`：直接刷新

`ends`：输出一个空字符并刷新



#### unitbuf 操纵符

设置 `unitbuf` 操纵符

```cpp
cout << unitbuf; // 接下来每次写操作后立即刷新
cout << nounitbuf; // 回到正常的缓冲方式
```



程序崩溃缓冲区不会被刷新。



#### 关联输入和输出流

标准库将 `cout` 和 `cin` 关联在一起，输入流试图读数据会先刷新输出流。

`tie` 函数有两个重载版本，不带参数返回指向输出流指针或空指针。

第二个版本接收一个指向 `ostream` 的指针，将自己关联到此 `ostrean`，即 `x.tie(&o)` 将流 `x` 关联到 `o`。传空指针解开流关联，一个流最多关联到一个流，多个流可以同时关联一个 `ostream`



## 8.2 文件输入输出

头文件 `fstream` 定义了三个类型来支持文件 IO，`ifstrem`、`ofstream`、`fstream`。



这里讲了一些 `fstream` 类的使用方法，声明，`open`，`close`，`is_open`。



### 8.2.1 使用文件流对象

```cpp
ifstream in(ifile); // 构造一个 ifstream 并打开文件
ofstream out; // 构造一个输出文件流，未关联文件
```



#### 用 fstream 代替 iostream&

因为继承，如果一个函数用 `ostream&` 参数调用，那么也可以传递给它一个 `ofstream` 对象。



#### 成员函数 open 和 close

open 成员函数用来打开指定的文件，可能会失败。

```cpp
ofstream out;
out.open(ifile);
if(out){} // 检查是否成功，成功为真
```



打开另一个文件先关闭已关联文件，不然会打开失败，并导致 `failbit` 被置位。

当 `fstream` 对象销毁时，`close` 会自动被调用。



### 8.2.2 文件模式

`in` 读，`out` 写，`app` 每次写操作定位到文件末尾，`ate` 打开文件后立即定位到文件末尾，`trunc` 截断文件，`binary` 以二进制方式进行 IO



以 `out` 模式打开文件会丢弃已有数据，`app` 模式打开文件不会丢弃。



每个文件流类型都定义了一个默认文件模式。

每次调用 `open` 都会确定文件模式。



## 8.3 string 流

`sstream` 头文件定义了三个类型支持内存 IO。

`istringstream` 从 `string` 读取数据

`ostringstream` 向 `string` 写入数据

`stringstream` 既可以读也可以写

以上类都继承了 `iostream` 头文件中定义的类型。

还增加了特有的管理 `string` 流的操作



### 8.3.1 使用 istringstream

看了样例代码，还行。

大概是读一行到 `string` 中，再拿这个 `string` 当输入流



### 8.3.2 使用 ostringstream

对字符串流输出相当于对 `string` 对象添加字符。

可以使用 `.str()` 方法返回字符串流中 `string` 内容

我能想到用处，就是传参到 `ostream` 中得到输出而不输出到别的地方。



## 小结

